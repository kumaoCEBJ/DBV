# DBV
素人開発

## 開発環境
* VBValkyrie Ver1.04
* Windows10 / Microsoft Edge / Blazor WebAssembly

## 履歴
* 2025/10/04 v1.00 公開

## 操作
* 左クリック : 決定/表示の切り替え/表示の固定/ドラッグアンドドロップ(以下D&D)
  * 表示の切り替え
    * ユニット詳細のスキル一覧の通常/統合
    * 師団詳細のターゲット一覧のHP値/HP割合
  * 表示の固定
    * 師団一覧のユニット、称号一覧の称号/メダリオン、装備一覧の装備/カテゴリ
      * 解除は右クリック
  * D&Dの対象 : ユニット/師団/称号/装備/戦術効果/検索結果/シミュ結果/シミュ設定/シミュ詳細設定
    * 師団のD&Dは師団一覧の師団番号が対象
* 右クリック : 解除/削除/一部特殊操作
  * 師団番号を右クリックで師団解散
  * 特殊操作対象
    * フィルター : 指定した要素を除外対象にする
    * スキル選択 : 指定したカテゴリを入力欄にコピー
    * シミュ : 選択したスキルをOr対象にする⇔選択したスキルを除外対象にする

## 機能
* 出力 : クリップボードに指定した師団情報をコピー
* 重複検索 : 指定の枠線内に対象をD&Dで登録し検索/解除
  * 対象 : ユニット/称号/装備
* 一括処理 : 師団解散/称号全解除/装備全解除
* 検索
  * ユニット名検索 : 一文字でも一致していたら該当
  * スキル検索 : スキルの値の高い順にソート
  * 戦術スキル検索
    * 選択した効果が一つの場合はその効果でソート
    * 二つ選択している場合は検索条件1でソート
* シミュ : [後述](#シミュの説明)
* 称号一覧 : 称号の詳細欄をクリックすると重複検索
* 装備一覧 : 装備の詳細欄をクリックすると重複検索
* ユニット一覧
  * 表示上部 : ユニット一覧
  * 表示下部 : 編成済みのユニット一覧
* 師団詳細 : [後述](#師団詳細の説明)
* 検索結果
* シミュ結果
* BAN設定
  * 設定後の｢更新｣で対象が非表示
  * 編成済みの師団一覧も対象
* オプション : [後述](#オプションの説明)

## `不具合を認識しているが修正出来ないもの`
* D&D関連
  * ドロップ可能かどうかを表示する設定が常に許可状態
    * ドロップ時に判定をしているので解決扱い
* 特定の動作で文字の色がにじむ
  * 原因不明  
* 師団詳細の計算の誤差
  * ゲームの計算式と違う他色々
* シミュ実行中のメッセージ表示が不安定
  * 処理速度等の関係

## その他
* ゲーム内の説明と一致しなかったものをゲームの挙動に合わせて変更
  * コカトリス : ｢全力攻撃｣ → ｢全力攻撃 999｣
  * ｢〇〇赦免｣ : 〇〇適用の兵士運搬効果はなかった
  * ｢英雄覇気｣ : ｢師団指揮｣ + ｢師団支配｣ → ｢師団活性｣ + ｢師団指揮｣ + ｢師団支配｣
  * ｢罠の領域｣ : ｢地形無効｣/｢決戦領域｣で無効化
* 戦術検索結果一覧の効果欄で特攻毒と毒化付与が両方毒表記
* フィルターの特攻 : 無はユニットのみ適用
* 倍率のクリティカルダメージ : ユニットの速度を除外
* BAN設定に武将称号がない
  * ユニットのBAN設定と連動
* 一部一般ユニットのBAN設定がメダリオンと連動していない
  * ニューゲーム時の雇用状況に合わせて調整
  * 他はメダリオンのみで判定
* 称号/装備一覧の入力欄はスキルのカテゴリも対応
  * カテゴリ : スキル選択の上部に表示されている｢開幕効果｣や｢範囲攻撃｣等

## 師団詳細の説明
師団番号をマウスオーバーすると師団の所持スキルと簡易的なステータス等を表示します。
* ｢計算｣ : 戦闘開始直後を想定したステータス等とターゲットを表示します。
  * ターゲットは各ユニットのHPと防御のみで計算し、隊列等は考慮していません。
* ｢切替｣ : 師団活性枠/師団指揮枠の想定値と全パターンのターゲットを表示します。
  * 計算結果のステータスはゲームとの誤差が発生することがあります。
    * レベルから推測した経験値を使用しているので同じレベルでも一致しないことがあります。
    * レベル上限であっても誤差の発生を確認しています。開発中は誤差3まで確認しています。
    * 複雑な状況の場合は実装した処理が誤っている可能性があります。
  * ｢計算｣で使用可能な師団のアシストスキルは下記の通りです。
    * ｢師団活性/〇〇布陣/師団指揮/〇〇指揮/バリアー/兵士運搬/地形無効/決戦領域｣
* ユニットアイコン下の入力欄はHP割合/レベル/武功/弱体値を個別に適用するために使用します。
  * 有効/無効は入力欄横のチェックボックスで切り替えます。無効の場合は右側の全体用の値を使用します。
  * 弱体値はステータス別の指定は出来ません。
  * ｢軍団活性/軍団指揮/師団活性/活性指揮｣には他の師団の値を入力して下さい。
  * ｢結界の歪/師団弱体｣には相手の師団の値を入力して下さい。    
  * 入力された値がそれぞれの上限を超える場合は上限の値を指定するか処理を中止します。
  * 忠誠は報酬計算に使用します。個別の適用は出来ません。
* ｢計算｣後に縦に並ぶユニットアイコンの中で一番上のアイコンが想定されるターゲットです。
  * アイコン下の数値はターゲットが切り替わるHPです。
* ボーナスは0〜100の値でそのセーブデータで得た経験値から算出します。
  * ボーナスは各スタンスのステータス上昇に追加します。
    * 進撃スタンス : 攻撃に3+ボーナス
    * 防備スタンス : 防御に5+ボーナス
    * 計略スタンス : 速度と知力に4+ボーナス
    * 乱戦スタンス : 全種に1+ボーナス/2
  * ボーナスを推測するのは難しいのでゲーム内で直接確認して下さい。
    * 確認方法は同じ戦闘でスタンスだけ変更してステータスの変動を見ます。進撃→防備が手軽です。
  * ボーナスのざっくり参考値(周回数とそのセーブデータの最高レベル)
    * 周回数0レベル84 : 67
    * 周回数1レベル119 : 76
    * 周回数2レベル150 : 100
* 所持スキル一覧の｢終の奇跡｣は師団内で一番高い値のみ表示しています。
  * ゲームではスキルを所持しているユニット毎に発動します。
* 拠点の情報はデウスモードのものです。

## シミュの説明
指定したスキルとフィルターの設定から候補を作り、総当たりする処理です。
* 処理の結果が膨大な数になりやすいので出来るだけ条件を指定して下さい。
  * 具体的にはスキルの下限やフィルターを設定すると効果が大きいです。
  * 処理にかかる時間の目安は5000体で10秒前後、50000体で1分超です。
    * ｢中止｣ボタンはタイミング次第で中止できない場合があります。
* オプションで追加設定が可能です。
* 左右クリックで各スキルの状態を変更します。
  * 有効:And(左)/Or(右)/除外(右)、無効(左)
    * Andは指定したスキルを全て所持する必要があります。｢A and B and C｣
    * Orは指定したスキルの中から一つだけ所持します。｢A or B or C｣
      * ｢A or B and C or D｣のような指定は出来ません。
    * 除外の対象はパッシブスキル/リーダースキルのみです。称号/装備は詳細設定から除外して下さい。
* 通常シミュと詳細シミュがあります。詳細シミュは通常シミュで作る候補の中から選択して実行します。
  * 加護と特攻をフィルターに指定した場合、その条件を満たすだけで候補に選出します。
  * 称号や装備の簡易的なBAN機能があり、そのシミュでは候補に選出しません。
  * シミュ結果一覧はスキル設定の1〜3番目のスキルの値の高い順でソートします。
    * 単純に上から1〜3番目の判定です。例えば4番目のスキルのみを有効にしてもソートしません。
    * 倍率のオプションを追加した場合、1.倍率、2.スキル設定の1番目、3.2番目でソートします。
  * ｢撃破金運/グルメ魂｣のみ重複指定が可能です。
  * ｢専守防衛｣のようなスキル値のないスキルが重複する結果が表示されることがあります。
    * 例えば｢専守防衛｣と｢何か｣の装備がありその｢何か｣も指定されていた場合。
      * 組み合わせの一例としてその結果も含める方が柔軟性があると判断し残しています。
        * 今後変更する可能性があります。
  * 詳細設定にユニット/称号/装備をD&Dすると他の要素を無効にしてその要素を有効にします。
* ｢トレハン師団｣は指定した設定でトレハン用の師団を作成します。
  * おまけ機能です。総当たりではないので最高値ではない場合があります。
    * 処理にかなりの時間がかかります。下限と装備の設定をして下さい。
  * ｢トレハン｣以外のスキルをリーダースキルに指定することは出来ません。
    * リーダースキルに｢トレハン｣を所持するユニットがいない場合は処理を中止します。
  * 通常シミュでは実行出来ません。
  * アシストスキルは指定出来ません。
  * 糧食を除外しています。｢トレハン｣以外のスキルを設定しても糧食は候補に選出しません。
  * 結果一覧のスキル表記の優先度は｢次元斬撃｣ > ｢遠隔攻撃｣ > ｢専守防衛｣です。

## オプションの説明
* ｢前回の設定を読み込む｣を有効にすると師団一覧/BAN設定/オプションを保存して次回起動時に読み込みます。
  * 保存のタイミングはページ更新/終了時です。ブラウザのローカルストレージを使用しています。
    * 無条件で謎のツールのデータをブラウザに保存されるのは困ると思われるので初期値は無効です。
  * キャッシュは無条件で保存されます。インストールでアプリ利用出来ますが詳細は把握していません。
* 倍率/減算は特定のスキルのみを使用した簡易的な計算処理です。
  * ユニットの倍率計算に使用するスキルは下記の通りです。
    * ｢多段攻撃/全力攻撃/心核穿ち/巨人狩り/無効喰い/乾坤一擲/疾風迅雷/確率追撃/集約攻撃/範囲攻撃/加速進化/連携攻撃/致命必殺/カブト割/次元斬撃/｣
  * ユニット一覧の倍率ソートはユニットはリーダースキルを反映しません。師団ユニットは反映します。
* ｢シミュ結果に倍率を反映する｣を有効にするとシミュ結果一覧を倍率→1番目のスキル→2番目→3番目の順でソートします。
* ｢キャンセル命令〜候補数｣はシミュ結果の候補数が指定した値を超えた場合に処理を中止します。
  * ｢トレハン師団｣の場合は師団数が指定した値/10の値を超えた場合にも処理を中止します。
  * 中止処理ではなく中止命令なのでタイミング次第では中止出来ません。

## 今後
* やる : 出来る範囲の不具合修正
* やらない : ダメージ計算等の正確な計算が必要な機能の追加